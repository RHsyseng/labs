<!doctype html><html>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Manual SNO on baremetal - Labs@Sysdeseng</title>
<meta name=description content="Labs to play with Edge and Telco 5G sustaining technologies">
<meta name=generator content="Hugo 0.92.1">
<link href=https://pages.sysdeseng.com/labs/index.xml rel=alternate type=application/rss+xml>
<link rel=canonical href=https://pages.sysdeseng.com/labs/ocp/upi/sno-upi-baremetal/>
<link rel=stylesheet href=https://pages.sysdeseng.com/labs/css/theme.min.css>
<script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://pages.sysdeseng.com/labs/css/chroma.min.css>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js></script>
<script src=https://pages.sysdeseng.com/labs/js/bundle.js></script><style>:root{--custom-font-color:#ffffff;--custom-background-color:#cc0000}</style>
<meta property="og:title" content="Manual SNO on baremetal">
<meta property="og:description" content="Reference Lab Folder: https://github.com/RHsyseng/labs-index/tree/master/lab-manual-sno-upi-baremetal
External ref: https://github.com/eranco74/bootstrap-in-place-poc
First of all, download the rhcos-live image curl -Lk https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/rhcos-live.x86_64.iso > /var/lib/libvirt/images/rhcos-live.x86_64.iso Create an install config (take a look at the ‚Äúsamples‚Äù folder in lab-manual-sno-upi-baremetal) You need to add the SSH pub key and the pull secret to your install-config.yaml.
# Set to 0 the number of workers compute.replicas: 0 # Set to 1 the number of masters controlPlane.replicas: 1 # Set platform to none platform.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://pages.sysdeseng.com/labs/ocp/upi/sno-upi-baremetal/"><meta property="og:image" content="https://pages.sysdeseng.com/android-chrome-192x192.png"><meta property="article:section" content="OCP">
<meta property="og:site_name" content="Labs index">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://pages.sysdeseng.com/android-chrome-192x192.png">
<meta name=twitter:title content="Manual SNO on baremetal">
<meta name=twitter:description content="Reference Lab Folder: https://github.com/RHsyseng/labs-index/tree/master/lab-manual-sno-upi-baremetal
External ref: https://github.com/eranco74/bootstrap-in-place-poc
First of all, download the rhcos-live image curl -Lk https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/rhcos-live.x86_64.iso > /var/lib/libvirt/images/rhcos-live.x86_64.iso Create an install config (take a look at the ‚Äúsamples‚Äù folder in lab-manual-sno-upi-baremetal) You need to add the SSH pub key and the pull secret to your install-config.yaml.
# Set to 0 the number of workers compute.replicas: 0 # Set to 1 the number of masters controlPlane.replicas: 1 # Set platform to none platform.">
<meta itemprop=name content="Manual SNO on baremetal">
<meta itemprop=description content="Reference Lab Folder: https://github.com/RHsyseng/labs-index/tree/master/lab-manual-sno-upi-baremetal
External ref: https://github.com/eranco74/bootstrap-in-place-poc
First of all, download the rhcos-live image curl -Lk https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/rhcos-live.x86_64.iso > /var/lib/libvirt/images/rhcos-live.x86_64.iso Create an install config (take a look at the ‚Äúsamples‚Äù folder in lab-manual-sno-upi-baremetal) You need to add the SSH pub key and the pull secret to your install-config.yaml.
# Set to 0 the number of workers compute.replicas: 0 # Set to 1 the number of masters controlPlane.replicas: 1 # Set platform to none platform.">
<meta itemprop=wordCount content="642"><meta itemprop=image content="https://pages.sysdeseng.com/android-chrome-192x192.png">
<meta itemprop=keywords content="SNO,UPI,labs,IPv4,baremetal,"></head>
<body><div class=container><header>
<h1>Labs@Sysdeseng</h1>
<p class=description>Labs to play with Edge and Telco 5G sustaining technologies</p>
</header>
<div class=global-menu>
<nav>
<ul>
<li><a href=/labs/search>üîçsearch</a></li></ul>
</nav>
</div>
<div class=content-container>
<main><h1>Manual SNO on baremetal</h1>
<aside class=table_of_contents>
<h5>Table of Contents</h5><nav id=TableOfContents>
<ul>
<li><a href=#reference>Reference</a></li>
<li><a href=#first-of-all-download-the-rhcos-live-image>First of all, download the <code>rhcos-live</code> image</a></li>
<li><a href=#create-an-install-config>Create an install config</a></li>
<li><a href=#create-the-ignition-files-for-the-sno-deployment>Create the ignition files for the SNO deployment</a></li>
<li><a href=#create-the-embedded-iso-image-with-the-ignition-correctly-generated-before>Create the embedded ISO image with the ignition correctly generated before:</a></li>
<li><a href=#create-vm-with-the-iso-attached>Create VM with the ISO attached</a></li>
<li><a href=#create-dns-entry-were-gonna-create>Create DNS entry we&rsquo;re gonna create:</a></li>
<li><a href=#review-the-installation>Review the installation</a></li>
</ul>
</nav></aside>
<h2 id=reference>Reference</h2>
<p>Lab Folder: <a href=https://github.com/RHsyseng/labs-index/tree/master/lab-manual-sno-upi-baremetal>https://github.com/RHsyseng/labs-index/tree/master/lab-manual-sno-upi-baremetal</a></p>
<p>External ref: <a href=https://github.com/eranco74/bootstrap-in-place-poc>https://github.com/eranco74/bootstrap-in-place-poc</a></p>
<h2 id=first-of-all-download-the-rhcos-live-image>First of all, download the <code>rhcos-live</code> image</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>curl -Lk https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/latest/latest/rhcos-live.x86_64.iso &gt; /var/lib/libvirt/images/rhcos-live.x86_64.iso
</code></pre></div><h2 id=create-an-install-config>Create an install config</h2>
<p>(take a look at the ‚Äúsamples‚Äù folder in <code>lab-manual-sno-upi-baremetal</code>)
You need to add the <strong>SSH pub key</strong> and the <strong>pull secret</strong> to your <code>install-config.yaml</code>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-console data-lang=console># Set to <span style=color:#ae81ff>0</span> the number of workers
compute.replicas: 0
<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span># Set to <span style=color:#ae81ff>1</span> the number of masters
controlPlane.replicas: 1
<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span># Set platform to none
platform.none:{}
<span style=color:#960050;background-color:#1e0010>
</span><span style=color:#960050;background-color:#1e0010></span># IMPORTANT! <span style=color:#f92672>(</span> If you‚Äôre using physical baremetal /dev/sda<span style=color:#f92672>)</span>
bootstrapInPlace.InstallationDisk: /dev/vda
</code></pre></div><h2 id=create-the-ignition-files-for-the-sno-deployment>Create the ignition files for the SNO deployment</h2>
<p>Install the OpenShift installer with the command below (be careful setting the proper version in the URL).</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>[</span>root@qct-d14u11 sno-baremetal<span style=color:#f92672>]</span><span style=color:#75715e># curl https://mirror.openshift.com/pub/openshift-v4/amd64/clients/ocp/4.8.0/openshift-install-linux-4.8.0.tar.gz -o openshift-install-linux-4.8.0.tar.gz</span>
</code></pre></div><p>Launch the command below to create the ignition file.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>[</span>root@qct-d14u11 sno-baremetal<span style=color:#f92672>]</span><span style=color:#75715e># openshift-install create single-node-ignition-config</span>
INFO Consuming Install Config from target directory
WARNING Making control-plane schedulable by setting MastersSchedulable to true <span style=color:#66d9ef>for</span> Scheduler cluster settings
INFO Single-Node-Ignition-Config created in: . and auth

</code></pre></div><h2 id=create-the-embedded-iso-image-with-the-ignition-correctly-generated-before>Create the embedded ISO image with the ignition correctly generated before:</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>[</span>root@qct-d14u11 sno-baremetal<span style=color:#f92672>]</span><span style=color:#75715e># cp /var/lib/libvirt/images/rhcos-live.x86_64.iso .</span>
<span style=color:#f92672>[</span>root@qct-d14u11 sno-baremetal<span style=color:#f92672>]</span><span style=color:#75715e># coreos-installer iso ignition embed ./rhcos-live.x86_64.iso -i config.ign -f</span>
</code></pre></div><p>You need to copy to the <code>libvirt</code> route</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>[</span>root@qct-d14u11 sno-baremetal<span style=color:#f92672>]</span><span style=color:#75715e># cp rhcos-live.x86_64.iso /var/lib/libvirt/images/rhcos-embed-sno.x86_64.iso</span>
</code></pre></div><h2 id=create-vm-with-the-iso-attached>Create VM with the ISO attached</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>[</span>root@qct-d14u11 sno-baremetal<span style=color:#f92672>]</span><span style=color:#75715e># kcli create vm -P iso=/var/lib/libvirt/images/rhcos-embed-sno.x86_64.iso -P memory=16835 -P numcpus=8 -P disks=[40] -P nets=[&#39;{&#34;name&#34;:&#34;default&#34;,&#34;ip&#34;:&#34;192.168.122.152&#34;,&#34;netmask&#34;:&#34;24&#34;,&#34;gateway&#34;:&#34;192.168.122.1&#34;}&#39;] mymachine</span>

</code></pre></div><h2 id=create-dns-entry-were-gonna-create>Create DNS entry we&rsquo;re gonna create:</h2>
<p>Once the VM has been launched we can get the IP address assigned by the DHCP in order to create the DNS records to resolve all the required names. Run the command below to get the IP address of your VM.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>[</span>root@qct-d14u11 sno-baremetal<span style=color:#f92672>]</span><span style=color:#75715e># kcli list vm</span>
+-----------+--------+----------------+--------+-------+---------+
|    Name   | Status |      Ips       | Source |  Plan | Profile |
+-----------+--------+----------------+--------+-------+---------+
| mymachine |   up   | 192.168.122.152|        | kvirt |  kvirt  |
+-----------+--------+----------------+--------+-------+---------+
</code></pre></div><p>In the output of the <code>kcli</code> we see that the IP address for you VM is <code>192.168.122.152</code>. Add to the <code>/etc/hosts</code> the entries of our cluster pointing to this IP.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>[</span>root@qct-d14u11 sno-baremetal<span style=color:#f92672>]</span><span style=color:#75715e># tail -1 /etc/hosts</span>
192.168.122.152 api.alk-sno.karmalabs.com console-openshift-console.apps.alk-sno.karmalabs.com oauth-openshift.apps.alk-sno.karmalabs.com prometheus-k8s-openshift-monitoring.apps.alk-sno.karmalabs.com
</code></pre></div><p>Also the dns entry with <code>kcli</code> to be resolved within the VM:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>kcli create dns -i 192.168.122.152 api.alk-sno.karmalabs.com -a api-int.alk-sno.karmalabs.com -a console-openshift-console.apps.alk-sno.karmalabs.com -a oauth-openshift.apps.alk-sno.karmalabs.com -a canary-openshift-ingress-canary.apps.alk-sno.karmalabs.com
</code></pre></div><h2 id=review-the-installation>Review the installation</h2>
<p>Connect to the VM:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>crictl ps | wc -l
</code></pre></div><p>The amount of containers running should be around 129</p>
<p>From the hypervisor configure the <code>KUBECONFIG</code> environment variable pointing to the generated <code>kubeconfig</code> file within the folder where the <code>openshift-insller</code> was executed. Once the authentication is configured run the below commands to check the status of our cluster:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>[</span>root@qct-d14u11 sno-baremetal<span style=color:#f92672>]</span><span style=color:#75715e># oc get node</span>
NAME                      STATUS   ROLES           AGE   VERSION
api.alk-sno.karmalabs.com   Ready    master,worker   56m   v1.21.1+f36aa36
</code></pre></div><p>Also check the status of all the OpenShift operators:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#f92672>[</span>root@qct-d14u11 sno-baremetal<span style=color:#f92672>]</span><span style=color:#75715e># oc get co</span>
NAME                                       VERSION   AVAILABLE   PROGRESSING   DEGRADED   SINCE
authentication                             4.8.0     True        False         False      13m
baremetal                                  4.8.0     True        False         False      48m
cloud-credential                           4.8.0     True        False         False      35m
cluster-autoscaler                         4.8.0     True        False         False      48m
config-operator                            4.8.0     True        False         False      55m
console                                    4.8.0     True        False         False      11m
csi-snapshot-controller                    4.8.0     True        False         False      40m
dns                                        4.8.0     True        False         False      48m
etcd                                       4.8.0     True        False         False      50m
image-registry                             4.8.0     True        False         False      44m
ingress                                    4.8.0     True        False         False      46m
insights                                   4.8.0     True        False         False      49m
kube-apiserver                             4.8.0     True        False         False      44m
kube-controller-manager                    4.8.0     True        False         False      45m
kube-scheduler                             4.8.0     True        False         False      45m
kube-storage-version-migrator              4.8.0     True        False         False      55m
machine-api                                4.8.0     True        False         False      48m
machine-approver                           4.8.0     True        False         False      51m
machine-config                             4.8.0     True        False         False      43m
marketplace                                4.8.0     True        False         False      50m
monitoring                                 4.8.0     True        False         False      41m
network                                    4.8.0     True        False         False      56m
node-tuning                                4.8.0     True        False         False      49m
openshift-apiserver                        4.8.0     True        False         False      45m
openshift-controller-manager               4.8.0     True        False         False      44m
openshift-samples                          4.8.0     True        False         False      45m
operator-lifecycle-manager                 4.8.0     True        False         False      51m
operator-lifecycle-manager-catalog         4.8.0     True        False         False      49m
operator-lifecycle-manager-packageserver   4.8.0     True        False         False      46m
service-ca                                 4.8.0     True        False         False      55m
storage                                    4.8.0     True        False         False      49m
</code></pre></div><div class=edit-meta>
<br></div><nav class=pagination><a class="nav nav-prev" href=https://pages.sysdeseng.com/labs/ocp/upi/ title="User Provisioned Infrastructure (UPI)"><i class="fas fa-arrow-left" aria-hidden=true></i>&nbsp;Prev - User Provisioned Infrastructure (UPI)</a>
<a class="nav nav-next" href=https://pages.sysdeseng.com/labs/ocp/pull-secret-validator/ title="Pull Secret Validator tool">Next - Pull Secret Validator tool <i class="fas fa-arrow-right" aria-hidden=true></i></a>
</nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p>
</footer>
</main>
<div class=sidebar>
<nav class=slide-menu>
<ul>
<li><a href=https://pages.sysdeseng.com/labs>Home</a></li>
<li class="parent has-sub-menu"><a href=https://pages.sysdeseng.com/labs/ocp/>Labs to install an OpenShift cluster<span class="mark opened">-</span></a>
<ul class=sub-menu>
<li class=has-sub-menu><a href=https://pages.sysdeseng.com/labs/ocp/ipi/>Installer Provisioned Infrastructure (IPI)<span class="mark closed">+</span></a>
<ul class=sub-menu>
<li><a href=https://pages.sysdeseng.com/labs/ocp/ipi/kcli-ipi-metal3-ipv4con/>kcli with Metal¬≥ and IPv4 connected</a></li>
<li><a href=https://pages.sysdeseng.com/labs/ocp/ipi/kcli-ipi-metal3-ipv6disc/>kcli with Metal¬≥ and IPv6 disconnected</a></li>
<li><a href=https://pages.sysdeseng.com/labs/ocp/ipi/kcli-ipi-withoutmetal3-ipv4con/>kcli without Metal¬≥ and IPv4 connected</a></li>
<li><a href=https://pages.sysdeseng.com/labs/ocp/ipi/openshift-4.7-aws/>OpenShift 4.7 on AWS</a></li>
</ul>
</li>
<li class="parent has-sub-menu"><a href=https://pages.sysdeseng.com/labs/ocp/upi/>User Provisioned Infrastructure (UPI)<span class="mark opened">-</span></a>
<ul class=sub-menu>
<li class=active><a href=https://pages.sysdeseng.com/labs/ocp/upi/sno-upi-baremetal/>Manual SNO on baremetal</a></li>
</ul>
</li>
<li><a href=https://pages.sysdeseng.com/labs/ocp/pull-secret-validator/>Pull Secret Validator tool</a></li>
</ul>
</li>
<li class=has-sub-menu><a href=https://pages.sysdeseng.com/labs/deploy/>Deploy Operators and Resources<span class="mark closed">+</span></a>
<ul class=sub-menu>
<li class=has-sub-menu><a href=https://pages.sysdeseng.com/labs/deploy/operator/>Operator<span class="mark closed">+</span></a>
<ul class=sub-menu>
<li><a href=https://pages.sysdeseng.com/labs/deploy/operator/localstorage/>LocalStorage</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/operator/hive/>Hive</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/operator/assistedinstaller/>Assisted Installer</a></li>
</ul>
</li>
<li class=has-sub-menu><a href=https://pages.sysdeseng.com/labs/deploy/hub-spoke/>Hub & Spoke cluster<span class="mark closed">+</span></a>
<ul class=sub-menu>
<li><a href=https://pages.sysdeseng.com/labs/deploy/hub-spoke/acm/>Using Advanced Cluster Management (ACM)</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/hub-spoke/ai/>Using Assisted Installer (AI)</a></li>
</ul>
</li>
<li class=has-sub-menu><a href=https://pages.sysdeseng.com/labs/deploy/baremetalhost/>BareMetalHost<span class="mark closed">+</span></a>
<ul class=sub-menu>
<li><a href=https://pages.sysdeseng.com/labs/deploy/baremetalhost/virtual-over-acm/>Virtual over ACM</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/baremetalhost/virtual-over-ai/>Virtual over Assisted Installer</a></li>
</ul>
</li>
<li class=has-sub-menu><a href=https://pages.sysdeseng.com/labs/deploy/remoteworkernode/>RemoteWorkerNode<span class="mark closed">+</span></a>
<ul class=sub-menu>
<li><a href=https://pages.sysdeseng.com/labs/deploy/remoteworkernode/day2-spoke-worker/>Day2 with spoke cluster to add worker nodes</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/remoteworkernode/rwn-using-ai-crd/>Day2 with spoke cluster to add worker nodes</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/remoteworkernode/late-binding/>Late Binding adding new agents</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/remoteworkernode/rwn-to-day2-spoke-worker/>Remote Worker Node in Day2 spoke cluster to add worker nodes</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/remoteworkernode/rwn-to-ai-using-aicli-api/>RWN to Assisted Installer using AICLI API</a></li>
</ul>
</li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/sno-acm-spokesno-scripts/>Deploy a Hub SNO with ACM and Spoke SNO on top of it using scripts</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/lab-physical-ipv6disc/>Physical IPv6 Disconnected Lab</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/rhacm/>Red Hat Advanced Cluster Management (ACM)</a></li>
<li><a href=https://pages.sysdeseng.com/labs/deploy/ztp-the-hard-way/>ZTP The Hard Way</a></li>
</ul>
</li>
<li class=has-sub-menu><a href=https://pages.sysdeseng.com/labs/vocabulary/>Vocabularies<span class="mark closed">+</span></a>
<ul class=sub-menu>
<li><a href=https://pages.sysdeseng.com/labs/vocabulary/vocabulary/>Vocabulary</a></li>
</ul>
</li>
</ul>
</nav>
<div class=sidebar-footer></div>
</div>
</div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20>
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>